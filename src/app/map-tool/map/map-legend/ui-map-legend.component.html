<div class="map-legend">
  <!-- Bubble Legend -->
  <div
    class="map-legend__section group bubbles"
    [class.vertical]="hasChoropleth"
    [class.horizontal]="!hasChoropleth"
    *ngIf="hasBubbles"
  >
    <div class="map-legend__heading">{{ bubbleLabel }}</div>
    <div class="map-legend__items">
      <div class="map-legend__item small-bubble bubble-no-data">
        <span>{{ noData }}</span>
        <div class="legend-circle"></div>
      </div>
      <div class="map-legend__item small-bubble">
        <span>{{ minBubbleValue | number: "1.0-1" }}%</span>
        <div class="legend-circle"></div>
      </div>
      <div class="map-legend__item large-bubble">
        <span>{{ maxBubbleValue | number: "1.0-1" }}%</span>
        <div class="legend-circle"></div>
      </div>
    </div>
  </div>
  <!-- Divider -->
  <div class="map-legend__divider" *ngIf="hasBubbles && hasChoropleth"></div>
  <!-- Choropleth legend -->
  <div
    class="map-legend__section group vertical choropleth"
    *ngIf="hasChoropleth"
  >
    <div class="map-legend__heading">{{ choroplethLabel }}</div>
    <div class="map-legend__items">
      <div class="map-legend__item choropleth-no-data">
        <span>{{ noData }}</span>
        <div class="no-data-square"></div>
      </div>
      <div class="map-legend__item choropleth-legend">
        <div class="label-group">
          <span class="legend-start">{{ formatValue(stops[2]) }}</span>
          <span class="legend-middle">{{
            formatValue((stops[2] + stops[stops.length - 2]) / 2)
          }}</span>
          <span class="legend-end"
            >{{ formatValue(stops[stops.length - 2]) }}+</span
          >
        </div>
        <div
          class="choropleth-gradient"
          [style.background]="legendGradient"
        ></div>
      </div>
    </div>
  </div>
</div>
