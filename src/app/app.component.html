<div class="app-wrapper" [class.map-active]="!activeFeature" [class.data-active]="activeFeature">
    <div class="header-wrapper">
        <div class="header-content">
            <img src="./assets/logo.png" class="header-logo" />
            <app-predictive-search
                class="search"
                [options]="mapFeatures"
                optionField="properties.name"
                (selectionChange)="onSearchSelect($event)">
            </app-predictive-search>
            <app-ui-select
                class="language-select"
                [values]="['English', 'Spanish']"
            ></app-ui-select>
            <button class="btn">
                <span class="glyphicon glyphicon-menu-hamburger"></span>
            </button>
        </div>
    </div>
    <div class="map-wrapper">
        <app-mapbox
            [mapConfig]="mapConfig" 
            [eventLayers]="mapEventLayers"
            (ready)="onMapReady($event)"
            (zoom)="onMapZoom($event)"
            (featureClick)="onFeatureClick($event)"
            (hoverChanged)="onFeatureHover($event)"
            (render)="onMapRender($event)">
        </app-mapbox>
    </div>
    <div class="map-ui-wrapper">
        <app-progress-bar *ngIf="mapLoading"></app-progress-bar>
        <div class="map-ui">
            <app-ui-select
                tabindex="4"
                class="eviction-select"
                label="Eviction"
                [values]="['Judgments', 'Filings']"
            ></app-ui-select>
            <app-ui-select
                tabindex="5"
                class="layer-select"
                label="Display"
                labelProperty="name"
                [selectedValue]="activeDataLevel"
                [values]="selectDataLevels"
                (change)="setGroupVisibility($event)">
            </app-ui-select>
            <app-ui-select
                tabindex="6"
                class="highlight-select"
                label="Display"
                labelProperty="name"
                [values]="attributes"
                (change)="setDataHighlight($event)">
            </app-ui-select>
            <div *ngIf="activeDataHighlight" class="map-legend" [style.background]="getLegendGradient()">
                <span class="legend-start">{{legend[0][0]}}</span>
                <span class="legend-end">{{legend[legend.length - 1][0]}}</span>
            </div>
            <app-ui-hint 
            *ngIf="activeDataLevel"
            class="legend-hint"
            [hint]="'The colored ' + activeDataLevel['name'] + ' on the map represent ' + activeDataHighlight['name'] + ' from ' + legend[0][0] + ' to ' + legend[legend.length - 1][0] + '.'" 
            placement="bottom"
        ></app-ui-hint>
        </div>
        <app-ui-slider tabindex="9"
            class="year-slider"
            [currentValue]="dataYear" 
            [min]="1990" 
            [max]="2015" 
            (change)="setDataYear($event)"
        ></app-ui-slider>
        <app-map-tooltip 
            [dataYear]="dataYear" 
            (click)="activeFeature = hoveredFeature; hoveredFeature = null;" 
            [feature]="hoveredFeature"
        ></app-map-tooltip>
    </div>
    <div class="data-wrapper" *ngIf="activeFeature">
        <div class="header-row">
            <h1 class="h3 header-row-title">
                {{ activeFeature.properties["name"] }}
                <small class="header-row-subtitle">{{ activeFeature.properties["parent-location"] }}</small>
            </h1>
            <button type="button" class="close" aria-label="Close" (click)="activeFeature = null;">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="data-content">
            <div class="data-content-inner">
                <app-ui-toggle [values]="[ 'Line', 'Bar' ]"></app-ui-toggle>
                <app-graph [data]="graphData" [settings]="graphSettings"></app-graph>
                <button class="btn btn-primary" (click)="showFileDialog($event)">Download File</button>
            </div>
        </div>
    </div>
</div>
